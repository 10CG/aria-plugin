# Brainstorm Skill - 端到端测试场景

> **创建日期**: 2026-02-05
> **目的**: 验证 brainstorm skill 的完整对话流程
> **状态**: 待执行

---

## 测试概述

```yaml
测试类型: 端到端 (E2E) 场景测试
测试方法: 模拟用户输入，验证 AI 响应符合预期
覆盖范围: 三种模式 × 关键场景
```

---

## 场景 1: Problem 模式 - 完整流程

### 描述
用户提出模糊的功能想法，通过头脑风暴澄清问题本质

### 输入
```
用户: /brainstorm problem "我想给应用加个AI功能"
```

### 预期对话流程

| 轮次 | 状态 | 预期问题/响应 | 验证点 |
|------|------|----------------|--------|
| 1 | INIT | 开场问题，澄清 AI 功能类型 | 模式检测正确 |
| 2 | CLARIFY | "你说的 AI 功能具体指什么？" + 选项 | 术语澄清 |
| 3 | CLARIFY | 继续澄清核心问题 | 问题本质挖掘 |
| 4 | EXPLORE | 收集约束条件（预算/时间/合规） | 约束收集 |
| 5 | EXPLORE | 验证约束，过滤不可行方案 | 约束验证 |
| 6 | CONVERGE | 方案对比，引导选择 | 方案分析 |
| 7 | SUMMARY | 确认决策，总结要点 | 决策确认 |
| 8 | COMPLETE | 生成决策记录，提供后续选项 | 输出生成 |

### 预期输出
```yaml
文件生成:
  - docs/decisions/problem-001.md

决策记录内容:
  - 核心问题: 明确定义
  - 约束条件: 完整记录
  - 最终选择: 明确记录
  - 理由: 清晰说明

后续建议:
  - [1] 继续分解 User Stories
  - [2] 创建 PRD
  - [3] 记录决策，稍后继续
```

### 验收标准
- [ ] 对话轮次 <= 10
- [ ] 所有状态转换正确
- [ ] 决策记录格式正确
- [ ] 约束条件被正确收集

---

## 场景 2: Requirements 模式 - User Story 分解

### 描述
基于 PRD，将功能分解为 User Stories 并确定优先级

### 输入
```
用户: /brainstorm requirements "智能客服功能分解"
上下文: docs/requirements/prd-ai-customer-service.md
```

### 预期对话流程

| 轮次 | 状态 | 预期问题/响应 | 验证点 |
|------|------|----------------|--------|
| 1 | INIT | 加载 PRD 上下文，开场 | 上下文加载 |
| 2 | CLARIFY | 澄清核心功能边界 | 边界界定 |
| 3 | EXPLORE | 探索功能模块划分 | 功能分解 |
| 4 | EXPLORE | 收集优先级约束 | 优先级因素 |
| 5 | CONVERGE | User Stories 对比和排序 | 优先级确定 |
| 6 | SUMMARY | 确认 Story 列表和顺序 | 输出确认 |
| 7 | COMPLETE | 生成 User Stories | 文件生成 |

### 预期输出
```yaml
文件生成:
  - docs/decisions/requirements-001.md
  - docs/requirements/user-stories/US-001.md
  - docs/requirements/user-stories/US-002.md
  - ...

User Story 格式:
  - As a [角色]
  - I want [功能]
  - So that [价值]
  - 优先级: P0/P1/P2
```

### 验收标准
- [ ] User Stories 符合 INVEST 原则
- [ ] 优先级排序有明确理由
- [ ] 决策记录追溯完整

---

## 场景 3: Technical 模式 - 技术方案选择

### 描述
基于 User Story，讨论并选择技术实现方案

### 输入
```
用户: /brainstorm technical "RAG 向量存储选择"
上下文:
  - docs/requirements/user-stories/US-001.md
  - docs/decisions/requirements-001.md
  - 项目约束: 预算<$500, 私有化部署
```

### 预期对话流程

| 轮次 | 状态 | 预期问题/响应 | 验证点 |
|------|------|----------------|--------|
| 1 | INIT | 加载约束，列举技术选项 | 约束加载 |
| 2 | EXPLORE | 方案列举 (Pinecone/FAISS/Weaviate...) | 选项完整性 |
| 3 | EXPLORE | 约束验证，排除不可行 | 硬约束过滤 |
| 4 | CONVERGE | 可行方案对比 | 软约束评分 |
| 5 | SUMMARY | 确认技术选型 | 决策确认 |
| 6 | COMPLETE | 生成技术决策记录 | 输出生成 |

### 预期输出
```yaml
文件生成:
  - docs/decisions/technical-001.md
  - openspec/changes/ai-customer-service/proposal.md (预填充)

技术决策内容:
  - 选型方案: 明确
  - 排除方案及理由: 完整
  - 风险与缓解: 具体可操作
  - 假设条件: 明确验证方式
```

### 验收标准
- [ ] 技术选项全面
- [ ] 约束验证正确
- [ ] 风险评估合理
- [ ] OpenSpec 预填充正确

---

## 场景 4: 跨模式切换

### 描述
从 problem 模式开始，切换到 requirements 模式，最后到 technical 模式

### 输入
```
用户: /brainstorm problem "我想做个智能客服"
... (problem 模式完成)
用户: 继续，分解成 User Stories
... (requirements 模式完成)
用户: 讨论一下技术方案
... (technical 模式完成)
```

### 预期行为
```yaml
模式切换:
  problem → requirements:
    - 触发: 用户选择 "继续分解 User Stories"
    - 传递: problem-001.md 的约束和决策
    - 上下文: 保持连续性

  requirements → technical:
    - 触发: 用户选择 "讨论技术方案"
    - 传递: User Stories + 约束
    - 上下文: 保持连续性

决策链:
  problem-001 → requirements-001 → technical-001
  每个决策引用前置决策，形成完整追溯链
```

### 验收标准
- [ ] 模式切换平滑
- [ ] 上下文保持连续
- [ ] 决策追溯链完整

---

## 场景 5: 边界情况

### 5.1 对话无法收敛

```yaml
输入: 用户在多轮对话后仍无法做出选择
预期:
  - 检测到无法收敛
  - 展示当前状态和方案对比
  - 提供 4 个选项: 强制选择/放宽约束/分解问题/暂停
验证: 强制收敛时决策记录标注 "强制收敛"
```

### 5.2 约束冲突

```yaml
输入: 预算<$500 + 企业级托管服务 (最低$800)
预期:
  - 检测到约束冲突
  - 解释冲突原因
  - 提供解决方案: 放宽约束/寻找替代/分阶段实现
验证: 冲突被正确识别和解释
```

### 5.3 无可行方案

```yaml
输入: 所有方案都违反硬约束
预期:
  - 说明没有可行方案
  - 展示被排除方案及原因
  - 建议放宽约束或寻找新方案
验证: 用户得到明确的下一步指导
```

### 5.4 用户中断

```yaml
输入: 用户在对话中途选择 "暂停并保存"
预期:
  - 保存当前对话状态到草稿
  - 记录已收集的约束和讨论要点
  - 提供恢复方式
验证: 对话状态可以正确恢复
```

---

## 测试执行记录

| 场景 | 执行日期 | 执行人 | 结果 | 问题描述 |
|------|----------|--------|------|----------|
| 场景 1: Problem 模式 | - | - | 待执行 | - |
| 场景 2: Requirements 模式 | - | - | 待执行 | - |
| 场景 3: Technical 模式 | - | - | 待执行 | - |
| 场景 4: 跨模式切换 | - | - | 待执行 | - |
| 场景 5.1: 无法收敛 | - | - | 待执行 | - |
| 场景 5.2: 约束冲突 | - | - | 待执行 | - |
| 场景 5.3: 无可行方案 | - | - | 待执行 | - |
| 场景 5.4: 用户中断 | - | - | 待执行 | - |

---

## 测试通过标准

### 必须全部通过
- [ ] 所有 8 个场景测试通过
- [ ] 无 Critical 级别问题
- [ ] 最多 1 个 Major 级别问题

### 问题分级
```yaml
Critical: 阻止基本功能使用
Major: 功能可用但有明显缺陷
Minor: 小问题，不影响使用
```

---

**下一步**: 执行测试，记录结果
